(function(){"use strict";window.nx=window.nx||{},nx.AsyncStatus={LOADING:1,DONE:2,ERROR:3},nx.AjaxModel=function(e){e=e||{},this.data=new nx.Cell,this.status=new nx.Cell,e.data!==void 0&&(this.data.value=e.data)},nx.AjaxModel.prototype.request=function(e){var t=this,n=nx.Utils.interpolateString(e.url,e.data);this.xhr=new XMLHttpRequest,this.xhr.open(e.method,n,!0),this.xhr.responseType=window.chrome?"text":"json",this.xhr.onload=function(){var n;200===this.status||201===this.status||204===this.status?(n=e.success,t.status.value=nx.AsyncStatus.DONE):(n=e.error,t.status.value=nx.AsyncStatus.ERROR),"function"==typeof n&&("json"===this.responseType?n(this.response):this.responseText?n(JSON.parse(this.responseText)):n())},"post"===e.method||"put"===e.method?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(e.data))):this.xhr.send(),t.status.value=nx.AsyncStatus.LOADING},window.nx=window.nx||{},nx.Binding=function(e,t,n,i,o){var s=this;this.mode=n,this.locked=!1,"<->"===n&&i instanceof nx.Mapping?o=o||i.inverse():"<-"===n&&(o=o||i),"<-"!==n&&e.onvalue.add(function(e){s.sync(t,e,i)}),"->"!==n&&t.onvalue.add(function(t){s.sync(e,t,o)})},nx.Binding.prototype.sync=function(e,t,n){if("<->"===this.mode){if(this.locked)return this.locked=!1,void 0;this.locked=!0}n!==void 0?n instanceof nx.Mapping?t=n.map(t,e.value):"function"==typeof n&&(t=n(t)):t=t,e.value=t,e.onsync.trigger(t)},window.nx=window.nx||{},nx.Cell=function(e){e=e||{},e.value!==void 0&&(this._value=e.value),this.onvalue=new nx.Event,this.onsync=new nx.Event},Object.defineProperty(nx.Cell.prototype,"value",{enumerable:!0,get:function(){return this._value},set:function(e){this._value=e,this.onvalue.trigger(e)}}),nx.Cell.prototype.bind=function(e,t,n,i){var o=new nx.Binding(this,e,t,n,i);return"<-"===t?o.sync(this,e.value,n):o.sync(e,this.value,n),o},nx.Cell.prototype.set=function(e){this._value=e},window.nx=window.nx||{},nx.Collection=function(e){e=e||{},this.items=e.items!==void 0?e.items:[],this.onappend=new nx.Event,this.onremove=new nx.Event,this.oninsertbefore=new nx.Event,this.onreset=new nx.Event,this.cell=new nx.Cell({value:this.items});var t=this;this.cell.onsync.add(function(e){t.items=e,t.onreset.trigger({items:e})})},nx.Collection.prototype.append=function(){var e=[].slice.call(arguments),t=this;e.forEach(function(e){t.items.push(e)}),this.onappend.trigger({items:e}),this.cell.value=this.items},nx.Collection.prototype.remove=function(){var e=[].slice,t=e.call(arguments),n=[];this.items=this.items.filter(function(e,i){var o=t.indexOf(e);return-1!==o?(n.push(i),t.splice(o,1),!1):!0}),this.onremove.trigger({items:e.call(arguments),indexes:n}),this.cell.value=this.items},nx.Collection.prototype.insertBefore=function(e,t){t=Array.isArray(t)?t:[t];var n=this.items.indexOf(e);[].splice.apply(this.items,[n,0].concat(t)),this.oninsertbefore.trigger({items:t,index:n}),this.cell.value=this.items},nx.Collection.prototype.removeAll=function(){this.items=[],this.onreset.trigger({items:[]}),this.cell.value=this.items},nx.Collection.prototype.set=function(e){this.items=e,this.onreset.trigger({items:e}),this.cell.value=this.items},nx.Collection.prototype.bind=function(e,t,n){return this.cell.bind(e,t,n)},window.nx=window.nx||{},nx.Event=function(){this.handlers={},this._nameIndex=0},nx.Event.prototype.trigger=function(e){for(var t in this.handlers)this.handlers[t].call(null,e)},nx.Event.prototype.add=function(e,t){return t=t||this._nameIndex++,this.handlers[t]=e,t},nx.Event.prototype.remove=function(e){delete this.handlers[e]},window.nx=window.nx||{},nx.Mapping=function(e){this.pattern=e},nx.Mapping.prototype.map=function(e,t){if(this.pattern!==void 0){for(var n in this.pattern)if("_"===n&&t!==void 0)t[this.pattern[n]]=e;else{if("_"===this.pattern[n]&&e!==void 0)return t=e[n];e!==void 0&&t!==void 0&&(t[this.pattern[n]]=e[n])}return t}return t=e},nx.Mapping.prototype.inverse=function(){var e={};for(var t in this.pattern)e[this.pattern[t]]=t;return new nx.Mapping(e)},window.nx=window.nx||{},window.nx.Utils=window.nx.Utils||{},nx.Utils.interpolateString=function(e,t){var n=e.match(/[^{\}]+(?=\})/g);return n&&n.forEach(function(n){e=e.replace("{"+n+"}",t[n])}),e},window.nxt=window.nxt||{},nxt.ContentManager=function(e){this.element=e,this.renderers={},this.regions=[]},nxt.ContentManager.prototype.render=function(){var e,t=[].slice.call(arguments),n=this,i=[];if(this.content=[],t.forEach(function(t){if(void 0!==t)if(t.dynamic){var o=new nxt[t.type+"Renderer"](n.element);o.render(t),i.push(o)}else if(n.renderers[t.type]===void 0&&(n.renderers[t.type]=new nxt[t.type+"Renderer"](n.element)),n.renderers[t.type].replace&&(n.renderers[t.type].replace=!1),n.renderers[t.type].render(t),n.renderers[t.type].content!==void 0&&n.content.push(n.renderers[t.type].content),i.length>0){e=new nxt.ContentRegion(n.element),e.insertReference=t.node;for(var s=0;i.length>s;s++)e.add(i[s]);n.regions.push(e),i=[]}}),i.length>0){e=new nxt.ContentRegion(n.element);for(var o=0;i.length>o;o++)e.add(i[o]);this.regions.push(e)}},window.nxt=window.nxt||{},nxt.ContentRegion=function(e){this.element=e,this.items=[],this.visibility=[]},nxt.ContentRegion.prototype.add=function(e){var t=this.items.length,n=this;this.items.push(e),this.insertReference!==void 0&&(e.insertReference=this.insertReference),e.visible.onvalue.add(function(e){var i=n.visibility[t];e&&!i?n.update(t,!0):!e&&i&&n.update(t,!1)})},nxt.ContentRegion.prototype.update=function(e,t){this.visibility[e]=t;var n;n=t?Array.isArray(this.items[e].content)?this.items[e].content[0]:this.items[e].content:this.items[e].insertReference?this.items[e].insertReference:this.insertReference;for(var i=e-1;i>=0&&(this.items[i].insertReference=n,!this.visibility[i]);i--);},window.nxt=window.nxt||{},nxt.Attr=function(e,t){return"string"==typeof e?{name:e,value:t,type:"Attr"}:{items:e,type:"Attr"}},nxt.Class=function(e,t){return{name:e,set:t,type:"Class"}},nxt.Text=function(e){return e===void 0?void 0:{text:e,node:document.createTextNode(e),type:"Node"}},nxt.Event=function(e,t){return{name:e,handler:t,type:"Event"}},nxt.Element=function(){var e=[].slice.call(arguments);e=e.reduce(function(e,t){return e.concat(t)},[]);var t=e[0],n=document.createElement(t);if(e.length>1){var i=e.slice(1),o=new nxt.ContentManager(n);nxt.ContentManager.prototype.render.apply(o,i)}return{name:t,node:n,type:"Node"}},nxt.Binding=function(e,t,n){return{cell:e,conversion:t,mode:n||"->",type:"Binding",dynamic:!0}},nxt.DelegatedEvent=function(e,t){return{name:e,handlers:t,type:"DelegatedEvent"}},nxt.Collection=function(){var e=arguments[0],t=arguments[1],n=[].slice.call(arguments,2);return{collection:e,conversion:t,events:n,type:"Collection",dynamic:!0}},window.nxt=window.nxt||{},nxt.AttrRenderer=function(e){this.element=e},nxt.AttrRenderer.prototype.render=function(e){if(e.items!==void 0)for(var t in e.items)this.element.setAttribute(t,e.items[t]);else this.element.setAttribute(e.name,e.value)},window.nxt=window.nxt||{},nxt.BindingRenderer=function(e){var t=this;this.element=e,this.cell=new nx.Cell,this.cell.onvalue.add(function(e){e!==void 0&&(!t.contentRenderer||!t.contentRenderer instanceof nxt[e.type+"Renderer"])&&(t.contentRenderer=new nxt[e.type+"Renderer"](t.element)),t.contentRenderer!==void 0&&(t.contentRenderer.insertReference=t.insertReference,t.contentRenderer.render(e),t.content=t.contentRenderer.content)}),this.visible=new nx.Cell,this.visible.bind(this.cell,"<-",function(e){return e!==void 0})},nxt.BindingRenderer.prototype.render=function(e){this.binding=e.cell.bind(this.cell,e.mode,e.conversion)},window.nxt=window.nxt||{},nxt.ClassRenderer=function(e){this.element=e},nxt.ClassRenderer.prototype.render=function(e){e.set?this.element.classList.add(e.name):this.element.classList.remove(e.name)},window.nxt=window.nxt||{},nxt.CollectionRenderer=function(e){this.element=e,this.content=[],this.visible=new nx.Cell},nxt.CollectionRenderer.prototype.render=function(e){var t=this;this.collection=e.collection,this.conversion=e.conversion,this.collection.onappend.add(function(e){t.append(e)}),this.collection.oninsertbefore.add(function(e){t.insertBefore(e)}),this.collection.onremove.add(function(e){t.remove(e)}),this.collection.onreset.add(function(e){t.reset(e)}),e.events.forEach(function(e){t.element.addEventListener(e.name,function(n){var i,o,s=n.target;t.content.some(function(e,t){var n=e.isEqualNode(s)||e.contains(s);return n&&(i=t,o=e),n});for(var r=Object.keys(e.handlers),l=function(o){s.matches(o)&&e.handlers[o].call(null,n,t.collection.items[i])};!o.isEqualNode(s);)r.forEach(l),s=s.parentNode;r.forEach(l)})}),this.collection.items!==void 0&&this.append({items:this.collection.items})},nxt.CollectionRenderer.prototype.append=function(e){var t=e.items.map(this.conversion),n=new nxt.ContentManager(this.element);nxt.ContentManager.prototype.render.apply(n,t),this.content=this.content.concat(n.content),this.visible.value=this.content.length>0},nxt.CollectionRenderer.prototype.insertBefore=function(e){var t=this;e.items.map(this.conversion).forEach(function(n){var i=new nxt[n.type+"Renderer"](t.element);i.insertReference=t.element.childNodes[e.index],i.render(n),i.content===void 0&&this.content.splice(e.index,1,i.content)})},nxt.CollectionRenderer.prototype.remove=function(e){var t=this;e.indexes.forEach(function(e){t.element.removeChild(t.element.childNodes[e]),t.content.splice(e,1)}),this.visible.value=this.content.length>0},nxt.CollectionRenderer.prototype.reset=function(e){for(var t=0;this.content.length>t;t++)this.element.removeChild(this.content[t]);this.content=[],this.append(e)},window.nxt=window.nxt||{},nxt.EventRenderer=function(e){this.element=e},nxt.EventRenderer.prototype.render=function(e){this.element.addEventListener(e.name,e.handler)},window.nxt=window.nxt||{},nxt.NodeRenderer=function(e){this.element=e,this.replace=!0},nxt.NodeRenderer.prototype.render=function(e){return e!==void 0?(this.insertReference!==void 0?this.element.insertBefore(e.node,this.insertReference):this.content!==void 0&&this.replace?this.element.replaceChild(e.node,this.content):this.element.appendChild(e.node),this.content=e.node):(this.element.removeChild(this.content),this.content=void 0),this.content},window.nx=window.nx||{},nx.RestCollection=function(e){nx.AjaxModel.call(this,e),this.options=e,this.items=new nx.Collection},nx.RestCollection.prototype=Object.create(nx.AjaxModel.prototype),nx.RestCollection.prototype.constructor=nx.RestCollection,nx.RestCollection.prototype.create=function(e,t){this.request({url:this.options.url,method:"post",data:e.data.value,success:function(n){e.data.value=n,"function"==typeof t&&t.call(null,n)}})},nx.RestCollection.prototype.retrieve=function(e){var t=this;this.request({url:this.options.url,method:"get",success:function(n){t.items.set(n.map(function(e){var n=new t.options.item({data:e,url:t.options.url});return n})),"function"==typeof e&&e.call(null,t.items)}})},window.nx=window.nx||{},nx.RestDocument=function(e){nx.AjaxModel.call(this,e),this.options=e},nx.RestDocument.prototype=Object.create(nx.AjaxModel.prototype),nx.RestDocument.prototype.constructor=nx.RestDocument,nx.RestDocument.prototype.retrieve=function(e){var t=this;this.request({url:this.options.url,method:"get",success:function(n){t.data.value=n,"function"==typeof e&&e.call(null,n)}})},nx.RestDocument.prototype.save=function(e){var t=this;this.request({url:this.options.url,data:this.data.value,method:"put",success:function(n){t.data.value=n,"function"==typeof e&&e.call(null,n)}})},nx.RestDocument.prototype.remove=function(e){this.request({url:this.options.url,data:this.data.value,method:"delete",success:function(t){"function"==typeof e&&e.call(null,t)}})}})();