(function(){"use strict";window.nx=window.nx||{},window.nx.Utils=window.nx.Utils||{},nx.Utils.interpolateString=function(n,e){var t=n.match(/[^{\}]+(?=\})/g);return t&&t.forEach(function(t){n=n.replace("{"+t+"}",e[t])}),n},nx.Utils.mixin=function(n,e){var t=Object.getOwnPropertyNames(e);t.forEach(function(t){var o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o)})},window.nx=window.nx||{},nx.AsyncStatus={LOADING:1,DONE:2,ERROR:3},nx.AjaxModel=function(n){n=n||{},this.data=new nx.Cell,this.error=new nx.Cell,this.status=new nx.Cell,n.data!==void 0&&(this.data.value=n.data)},nx.AjaxModel.prototype.request=function(n){var e=this,t=nx.Utils.interpolateString(n.url,this.data.value);this.xhr=new XMLHttpRequest,this.xhr.open(n.method,t,!0),this.xhr.responseType=window.chrome?"text":"json",this.xhr.onload=function(){var t,o;"json"===this.responseType?o=this.response:this.responseText&&(o=JSON.parse(this.responseText)),200===this.status||201===this.status||204===this.status?(t=n.success,e.data.value=o,e.status.value=nx.AsyncStatus.DONE):(t=n.error,e.error.value=o,e.status.value=nx.AsyncStatus.ERROR),"function"==typeof t&&t(o)},"post"===n.method||"put"===n.method?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(this.data.value))):this.xhr.send(),e.status.value=nx.AsyncStatus.LOADING},window.nx=window.nx||{},nx.Binding=function(n,e,t,o,r){var i=this;this.mode=t,this.locked=!1,"<->"===t&&o instanceof nx.Mapping?r=r||o.inverse():"<-"===t&&(r=r||o),"<-"!==t&&n.onvalue.add(function(n){i.sync(e,n,o)}),"->"!==t&&e.onvalue.add(function(e){i.sync(n,e,r)})},nx.Binding.prototype.sync=function(n,e,t){if("<->"===this.mode){if(this.locked)return this.locked=!1,void 0;this.locked=!0}t!==void 0?t instanceof nx.Mapping?e=t.map(e,n.value):"function"==typeof t&&(e=t(e)):e=e,n.value=e,n.onsync.trigger(e)},window.nx=window.nx||{},nx.Cell=function(n){n=n||{},n.value!==void 0&&(this._value=n.value),this.onvalue=new nx.Event,this.onsync=new nx.Event,n.action!==void 0&&this.onvalue.add(n.action)},Object.defineProperty(nx.Cell.prototype,"value",{enumerable:!0,get:function(){return this._value},set:function(n){this._value=n,this.onvalue.trigger(n)}}),nx.Cell.prototype.bind=function(n,e,t,o){var r=new nx.Binding(this,n,e,t,o);return"<-"===e?r.sync(this,n.value,t):r.sync(n,this.value,t),r},nx.Cell.prototype.set=function(n){this._value=n},window.nx=window.nx||{},nx.Collection=function(n){n=n||{},nx.Cell.call(this);var e=this;this.event=new nx.Cell,this.items=n.items||[],this.onsync.add(function(n){e.event.value=new nxt.Command("Content","reset",{items:n})})},nx.Utils.mixin(nx.Collection.prototype,nx.Cell.prototype),nx.Collection.prototype.constructor=nx.Collection,Object.defineProperty(nx.Collection.prototype,"items",{enumerable:!0,get:function(){return this.value},set:function(n){this.value=n,this.event.value=new nxt.Command("Content","reset",{items:n})}}),nx.Collection.prototype.append=function(){var n=[].slice.call(arguments);this.value=this.value.concat(n),this.event.value=new nxt.Command("Content","append",{items:n})},nx.Collection.prototype.remove=function(){var n=[].slice,e=n.call(arguments),t=[];this.value=this.items.filter(function(n,o){var r=e.indexOf(n);return-1!==r?(t.push(o),e.splice(r,1),!1):!0}),this.event.value=new nxt.Command("Content","remove",{items:n.call(arguments),indexes:t})},nx.Collection.prototype.insertBefore=function(n,e){e=Array.isArray(e)?e:[e];var t=this.items.indexOf(n);[].splice.apply(this.items,[t,0].concat(e)),this.event.value=new nxt.Command("Content","insertBefore",{items:e,index:t})},nx.Collection.prototype.removeAll=function(){this.items=[]},window.nx=window.nx||{},nx.Event=function(){this.handlers={},this._nameIndex=0},nx.Event.prototype.trigger=function(n){for(var e in this.handlers)this.handlers[e].call(null,n)},nx.Event.prototype.add=function(n,e){return e=e||this._nameIndex++,this.handlers[e]=n,e},nx.Event.prototype.remove=function(n){delete this.handlers[n]},window.nx=window.nx||{},nx.Mapping=function(n){this.pattern=n},nx.Mapping.prototype.map=function(n,e){if(this.pattern!==void 0){for(var t in this.pattern)if("_"===t&&e!==void 0)e[this.pattern[t]]=n;else{if("_"===this.pattern[t]&&n!==void 0)return e=n[t];n!==void 0&&e!==void 0&&(e[this.pattern[t]]=n[t])}return e}return e=n},nx.Mapping.prototype.inverse=function(){var n={};for(var e in this.pattern)n[this.pattern[e]]=e;return new nx.Mapping(n)},window.nxt=window.nxt||{},nxt.Command=function(n,e,t){this.type=n,this.method=e,this.data=t},nxt.Command.prototype.run=function(){return this.renderer=new nxt[this.type+"Renderer"],this.renderer[this.method].apply(this.renderer,[this.data].concat([].slice.apply(arguments)))},window.nxt=window.nxt||{},nxt.ContentRegion=function(n){this.domContext=n,this.cells=[]},nxt.ContentRegion.prototype.add=function(n){this.cells.length;var e=this,t=new nx.Cell({value:{index:this.cells.length,domContext:{container:this.domContext.container,insertReference:this.domContext.insertReference},visible:!1},action:function(n){e.update(n)}});n.bind(t,"->",new nx.Mapping({_:"command"})),this.cells.push(t)},nxt.ContentRegion.prototype.update=function(n){var e=n.renderer!==void 0,t=n.command===void 0,o=n.visible;e&&(t?(n.domContext.content=n.renderer.unrender(n.domContext),n.visible=!1):n.renderer instanceof nxt[n.command.type+"Renderer"]||(n.domContext.content=n.renderer.unrender(n.domContext))),t||(n.domContext.content=n.command.run(n.domContext),n.renderer=n.command.renderer,n.visible="function"==typeof n.renderer.visible?n.renderer.visible(n.domContext.content):nxt.NodeRenderer.prototype.visible(n.domContext.content));var r;if(n.visible!==o){r=n.visible?Array.isArray(n.domContext.content)?n.domContext.content[0]:n.domContext.content:n.domContext.insertReference;for(var i=n.index-1;i>=0&&(this.cells[i].value.domContext.insertReference=r,!this.cells[i].value.visible);i--);}},window.nxt=window.nxt||{},nxt.ContentRenderer=function(){},nxt.ContentRenderer.prototype.render=function(n,e){this.regions=[];var t=[],o=[],r=this;return n.items.forEach(function(n){if(void 0!==n)if(n instanceof nx.Cell)t.push(n);else{var i=n.run(e);if(o.push(i),t.length>0){var s={container:e.container};new nxt[n.type+"Renderer"],nxt.NodeRenderer.prototype.visible(i)&&(s.insertReference=i),r.createRegion(s,t),t=[]}}}),t.length>0&&this.createRegion({container:e.container},t),o},nxt.ContentRenderer.prototype.createRegion=function(n,e){for(var t=new nxt.ContentRegion(n),o=0;e.length>o;o++)t.add(e[o]);this.regions.push(t)},nxt.ContentRenderer.prototype.append=function(n,e){return(e.content||[]).concat(this.render(n,{container:e.container,insertReference:e.insertReference}))},nxt.ContentRenderer.prototype.insertBefore=function(n,e){return n.items.forEach(function(t,o){var r=t.run({container:e.container,insertReference:e.content[n.insertIndex+o]});e.content.splice(n.insertIndex+o,0,r)}),e.content},nxt.ContentRenderer.prototype.remove=function(n,e){return n.indexes.sort(function(n,e){return n-e}).forEach(function(n,t){e.container.removeChild(e.content[n-t]),e.content.splice(n-t,1)}),e.content},nxt.ContentRenderer.prototype.reset=function(n,e){if(e.content!==void 0){for(var t=0;e.content.length>t;t++)e.container.removeChild(e.content[t]);delete e.content}return this.render(n,e)},nxt.ContentRenderer.prototype.get=function(n,e){return n.next(e.content),e.content},nxt.ContentRenderer.prototype.visible=function(n){return n.some(nxt.NodeRenderer.prototype.visible)},window.nxt=window.nxt||{},nxt.Attr=function(n,e){var t="string"==typeof n?{name:n,value:e===void 0?"":e}:{items:n};return new nxt.Command("Attr","render",t)},nxt.Class=function(n,e){return e===void 0&&(e=!0),e?new nxt.Command("Class","add",{name:n}):new nxt.Command("Class","remove",{name:n})},nxt.Text=function(n){return n===void 0?void 0:new nxt.Command("Node","render",{node:document.createTextNode(n),text:n})},nxt.Event=function(n,e){return new nxt.Command("Event","add",{name:n,handler:e})},nxt.Element=function(){var n=[].slice.call(arguments);n=n.reduce(function(n,e){return n.concat(e)},[]);var e=n[0],t=document.createElement(e);if(n.length>1){var o=n.slice(1),r=new nxt.ContentRenderer;r.render({items:o},{container:t})}return new nxt.Command("Node","render",{node:t})},nxt.Binding=function(n,e){var t=new nx.Cell;return n.bind(t,"->",e),t},nxt.ItemEvent=function(n,e){return{name:n,handlers:e}},nxt.Collection=function(){var n=arguments[0],e=arguments[1],t=[].slice.call(arguments,2),o=new nx.Cell;n.event.value=new nxt.Command("Content","reset",{items:n.items}),n.event.bind(o,"->",function(n){return n!==void 0&&(n.data.items=n.data.items.map(e)),n});var r;return t.length>0?(r=t.map(function(e){return nxt.Event(e.name,function(t){var o,r,i=t.target;n.event.value=new nxt.Command("Content","get",{items:[],next:function(s){s.some(function(n,e){var t=n.isEqualNode(i)||n.contains(i);return t&&(o=e,r=n),t});for(var a=Object.keys(e.handlers),c=function(r){i.matches(r)&&e.handlers[r].call(null,t,n.items[o])};!r.isEqualNode(i);)a.forEach(c),i=i.parentNode;a.forEach(c)}})})}),[o].concat(r)):o},window.nxt=window.nxt||{},nxt.AttrRenderer=function(){},nxt.AttrRenderer.prototype.render=function(n,e){var t={};if(n.items!==void 0){for(var o in n.items)e.container.setAttribute(o,n.items[o]);t=n.items}else e.container.setAttribute(n.name,n.value),t[n.name]=n.value;return t},nxt.AttrRenderer.prototype.unrender=function(n){for(var e in n.content)n.container.removeAttribute(e)},window.nxt=window.nxt||{},nxt.ClassRenderer=function(){},nxt.ClassRenderer.prototype.add=function(n,e){e.container.classList.add(n.name)},nxt.ClassRenderer.prototype.remove=function(n,e){e.container.classList.remove(n.name)},window.nxt=window.nxt||{},nxt.EventRenderer=function(){},nxt.EventRenderer.prototype.add=function(n,e){return e.container.addEventListener(n.name,n.handler),n},nxt.EventRenderer.prototype.unrender=function(n){n.container.removeEventListener(n.content.name,n.content.handler)},window.nxt=window.nxt||{},nxt.NodeRenderer=function(){},nxt.NodeRenderer.prototype.render=function(n,e){return e.content!==void 0?e.container.replaceChild(n.node,e.content):e.insertReference!==void 0?e.container.insertBefore(n.node,e.insertReference):e.container.appendChild(n.node),n.node},nxt.NodeRenderer.prototype.visible=function(n){return n!==void 0&&(n.nodeType===Node.ELEMENT_NODE||n.nodeType===Node.TEXT_NODE)},nxt.NodeRenderer.prototype.unrender=function(n){n.container.removeChild(n.content)},window.nx=window.nx||{},nx.RestCollection=function(n){nx.Collection.call(this,n),nx.AjaxModel.call(this,n),this.options=n;var e=this;this.bind(this.data,"<->",function(n){return n.map(function(n){return n.data.value})},function(n){return n.map(function(n){return new e.options.item({data:n,url:e.options.url})})})},nx.Utils.mixin(nx.RestCollection.prototype,nx.Collection.prototype),nx.Utils.mixin(nx.RestCollection.prototype,nx.AjaxModel.prototype),nx.RestCollection.prototype.constructor=nx.RestCollection,nx.RestCollection.prototype.request=function(n){var e=this;nx.AjaxModel.prototype.request.call(this,{url:this.options.url,method:n.method,success:function(){"function"==typeof n.success&&n.success(e.items)}})},nx.RestCollection.prototype.create=function(n,e){nx.RestDocument.prototype.request.call(n,{url:this.options.url,method:"post",success:e})},nx.RestCollection.prototype.retrieve=function(n){this.request({method:"get",success:n})},nx.RestCollection.prototype.remove=function(n,e){var t=this;n.remove(function(){nx.Collection.prototype.remove.call(t,n),"function"==typeof e&&e()})},window.nx=window.nx||{},nx.RestDocument=function(n){nx.AjaxModel.call(this,n),this.options=n},nx.Utils.mixin(nx.RestDocument.prototype,nx.AjaxModel.prototype),nx.RestDocument.prototype.constructor=nx.RestDocument,nx.RestDocument.prototype.request=function(n){nx.AjaxModel.prototype.request.call(this,{url:n.url||this.options.url,method:n.method,success:n.success})},nx.RestDocument.prototype.retrieve=function(n){this.request({method:"get",success:n})},nx.RestDocument.prototype.save=function(n){this.request({method:"put",success:n})},nx.RestDocument.prototype.remove=function(n){this.request({method:"delete",success:n})}})();