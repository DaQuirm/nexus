(function(){"use strict";window.nx=window.nx||{},nx.AsyncStatus={LOADING:1,DONE:2,ERROR:3},nx.AjaxModel=function(n){n=n||{},this.data=new nx.Cell,this.status=new nx.Cell,n.data!==void 0&&(this.data.value=n.data)},nx.AjaxModel.prototype.request=function(n){var t=this,e=nx.Utils.interpolateString(n.url,n.data);this.xhr=new XMLHttpRequest,this.xhr.open(n.method,e,!0),this.xhr.responseType=window.chrome?"text":"json",this.xhr.onload=function(){var e;200===this.status||201===this.status||204===this.status?(e=n.success,t.status.value=nx.AsyncStatus.DONE):(e=n.error,t.status.value=nx.AsyncStatus.ERROR),"function"==typeof e&&("json"===this.responseType?e(this.response):this.responseText?e(JSON.parse(this.responseText)):e())},"post"===n.method||"put"===n.method?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(n.data))):this.xhr.send(),t.status.value=nx.AsyncStatus.LOADING},window.nx=window.nx||{},nx.Binding=function(n,t,e,o,i){var r=this;this.mode=e,this.locked=!1,"<->"===e&&o instanceof nx.Mapping?i=i||o.inverse():"<-"===e&&(i=i||o),"<-"!==e&&n.onvalue.add(function(n){r.sync(t,n,o)}),"->"!==e&&t.onvalue.add(function(t){r.sync(n,t,i)})},nx.Binding.prototype.sync=function(n,t,e){if("<->"===this.mode){if(this.locked)return this.locked=!1,void 0;this.locked=!0}e!==void 0?e instanceof nx.Mapping?t=e.map(t,n.value):"function"==typeof e&&(t=e(t)):t=t,n.value=t,n.onsync.trigger(t)},window.nx=window.nx||{},nx.Cell=function(n){n=n||{},n.value!==void 0&&(this._value=n.value),this.onvalue=new nx.Event,this.onsync=new nx.Event,n.action!==void 0&&this.onvalue.add(n.action)},Object.defineProperty(nx.Cell.prototype,"value",{enumerable:!0,get:function(){return this._value},set:function(n){this._value=n,this.onvalue.trigger(n)}}),nx.Cell.prototype.bind=function(n,t,e,o){var i=new nx.Binding(this,n,t,e,o);return"<-"===t?i.sync(this,n.value,e):i.sync(n,this.value,e),i},nx.Cell.prototype.set=function(n){this._value=n},window.nx=window.nx||{},nx.Collection=function(n){n=n||{},nx.Cell.call(this);var t=this;this.event=new nx.Cell,this.items=n.items||[],this.onsync.add(function(n){t.event.value=new nxt.Command("Collection","reset",{items:n})})},nx.Collection.prototype=Object.create(nx.Cell.prototype),nx.Collection.prototype.constructor=nx.Collection,Object.defineProperty(nx.Collection.prototype,"items",{enumerable:!0,get:function(){return this.value},set:function(n){this.value=n,this.event.value=new nxt.Command("Collection","reset",{items:n})}}),nx.Collection.prototype.append=function(){var n=[].slice.call(arguments);this.value=this.value.concat(n),this.event.value=new nxt.Command("Collection","append",{items:n})},nx.Collection.prototype.remove=function(){var n=[].slice,t=n.call(arguments),e=[];this.value=this.items.filter(function(n,o){var i=t.indexOf(n);return-1!==i?(e.push(o),t.splice(i,1),!1):!0}),this.event.value=new nxt.Command("Collection","remove",{items:n.call(arguments),indexes:e})},nx.Collection.prototype.insertBefore=function(n,t){t=Array.isArray(t)?t:[t];var e=this.items.indexOf(n);[].splice.apply(this.items,[e,0].concat(t)),this.event.value=new nxt.Command("Collection","insertBefore",{items:t,index:e})},nx.Collection.prototype.removeAll=function(){this.items=[]},window.nx=window.nx||{},nx.Event=function(){this.handlers={},this._nameIndex=0},nx.Event.prototype.trigger=function(n){for(var t in this.handlers)this.handlers[t].call(null,n)},nx.Event.prototype.add=function(n,t){return t=t||this._nameIndex++,this.handlers[t]=n,t},nx.Event.prototype.remove=function(n){delete this.handlers[n]},window.nx=window.nx||{},nx.Mapping=function(n){this.pattern=n},nx.Mapping.prototype.map=function(n,t){if(this.pattern!==void 0){for(var e in this.pattern)if("_"===e&&t!==void 0)t[this.pattern[e]]=n;else{if("_"===this.pattern[e]&&n!==void 0)return t=n[e];n!==void 0&&t!==void 0&&(t[this.pattern[e]]=n[e])}return t}return t=n},nx.Mapping.prototype.inverse=function(){var n={};for(var t in this.pattern)n[this.pattern[t]]=t;return new nx.Mapping(n)},window.nx=window.nx||{},window.nx.Utils=window.nx.Utils||{},nx.Utils.interpolateString=function(n,t){var e=n.match(/[^{\}]+(?=\})/g);return e&&e.forEach(function(e){n=n.replace("{"+e+"}",t[e])}),n},window.nxt=window.nxt||{},nxt.Command=function(n,t,e){this.type=n,this.method=t,this.data=e},nxt.Command.prototype.run=function(){return this.renderer=new nxt[this.type+"Renderer"],this.renderer[this.method].apply(this.renderer,[this.data].concat([].slice.apply(arguments)))},window.nxt=window.nxt||{},nxt.ContentManager=function(){},nxt.ContentManager.prototype.render=function(n,t){this.regions=[];var e=[],o=[],i=this,r=function(n,t){for(var e=new nxt.ContentRegion(n),o=0;t.length>o;o++)e.add(t[o]);i.regions.push(e)};return n.forEach(function(n){if(void 0!==n)if(n instanceof nx.Cell)e.push(n);else{var i=n.run(t);o.push(i),e.length>0&&(r({container:t.container,insertReference:i},e),e=[])}}),e.length>0&&r({container:t.container},e),o},nxt.ContentManager.prototype.append=function(n,t){return(t.content||[]).concat(this.render(n,{container:t.container,insertReference:t.insertReference}))},nxt.ContentManager.prototype.insertBefore=function(n,t,e){return t.forEach(function(t,o){var i=t.run({container:e.container,insertReference:e.content[n+o]});e.content.splice(n+o,0,i)}),e.content},nxt.ContentManager.prototype.remove=function(n,t){return n.sort(function(n,t){return n-t}).forEach(function(n,e){t.container.removeChild(t.content[n-e]),t.content.splice(n-e,1)}),t.content},nxt.ContentManager.prototype.reset=function(n,t){if(t.content!==void 0){for(var e=0;t.content.length>e;e++)t.container.removeChild(t.content[e]);delete t.content}return this.render(n,t)},window.nxt=window.nxt||{},nxt.ContentRegion=function(n){this.domContext=n,this.cells=[]},nxt.ContentRegion.prototype.add=function(n){this.cells.length;var t=this,e=new nx.Cell({value:{index:this.cells.length,domContext:{container:this.domContext.container,insertReference:this.domContext.insertReference},visible:!1},action:function(n){t.update(n)}});n.bind(e,"->",new nx.Mapping({_:"command"})),this.cells.push(e)},nxt.ContentRegion.prototype.update=function(n){var t=n.renderer!==void 0,e=n.command===void 0;t&&(e?(n.domContext.content=n.renderer.unrender(n.domContext),n.visible=!1):n.renderer instanceof nxt[n.command.type+"Renderer"]||(n.domContext.content=n.renderer.unrender(n.domContext))),e||(n.domContext.content=n.command.run(n.domContext),n.renderer=n.command.renderer,n.visible="function"==typeof n.renderer.visible?n.renderer.visible(n.domContext.content):!1);var o;o=n.visible?Array.isArray(n.domContext.content)?n.domContext.content[0]:n.domContext.content:n.domContext.insertReference;for(var i=n.index-1;i>=0&&(this.cells[i].value.domContext.insertReference=o,!this.cells[i].value.visible);i--);},window.nxt=window.nxt||{},nxt.Attr=function(n,t){var e="string"==typeof n?{name:n,value:t===void 0?"":t}:{items:n};return new nxt.Command("Attr","render",e)},nxt.Class=function(n,t){return t===void 0&&(t=!0),t?new nxt.Command("Class","add",{name:n}):new nxt.Command("Class","remove",{name:n})},nxt.Text=function(n){return n===void 0?void 0:new nxt.Command("Node","render",{node:document.createTextNode(n),text:n})},nxt.Event=function(n,t){return new nxt.Command("Event","add",{name:n,handler:t})},nxt.Element=function(){var n=[].slice.call(arguments);n=n.reduce(function(n,t){return n.concat(t)},[]);var t=n[0],e=document.createElement(t);if(n.length>1){var o=n.slice(1),i=new nxt.ContentManager;i.render(o,{container:e})}return new nxt.Command("Node","render",{node:e})},nxt.Binding=function(n,t){var e=new nx.Cell;return n.bind(e,"->",t),e},nxt.DelegatedEvent=function(n,t){return new nxt.Command("DelegatedEvent","add",{name:n,handlers:t})},nxt.Collection=function(){var n=arguments[0],t=arguments[1];[].slice.call(arguments,2);var e=new nx.Cell;return n.event.value=new nxt.Command("Collection","reset",{items:n.items}),n.event.bind(e,"->",function(n){return n!==void 0&&(n.data.items=n.data.items.map(t)),n}),e},window.nxt=window.nxt||{},nxt.AttrRenderer=function(){},nxt.AttrRenderer.prototype.render=function(n,t){if(n.items!==void 0)for(var e in n.items)t.container.setAttribute(e,n.items[e]);else t.container.setAttribute(n.name,n.value)},window.nxt=window.nxt||{},nxt.ClassRenderer=function(){},nxt.ClassRenderer.prototype.add=function(n,t){t.container.classList.add(n.name)},nxt.ClassRenderer.prototype.remove=function(n,t){t.container.classList.remove(n.name)},window.nxt=window.nxt||{},nxt.CollectionRenderer=function(){this.manager=new nxt.ContentManager},nxt.CollectionRenderer.prototype.render=function(n){var t=this;n.events.forEach(function(n){t.element.addEventListener(n.name,function(e){var o,i,r=e.target;t.content.some(function(n,t){var e=n.isEqualNode(r)||n.contains(r);return e&&(o=t,i=n),e});for(var s=Object.keys(n.handlers),a=function(i){r.matches(i)&&n.handlers[i].call(null,e,t.collection.items[o])};!i.isEqualNode(r);)s.forEach(a),r=r.parentNode;s.forEach(a)})}),this.collection.items!==void 0&&this.append({items:this.collection.items})},nxt.CollectionRenderer.prototype.visible=function(n){return n.length>0},nxt.CollectionRenderer.prototype.append=function(n,t){return this.manager.append(n.items,t)},nxt.CollectionRenderer.prototype.insertBefore=function(n,t){return this.manager.insertBefore(n.index,n.items,t)},nxt.CollectionRenderer.prototype.remove=function(n,t){return this.manager.remove(n.indexes,t)},nxt.CollectionRenderer.prototype.reset=function(n,t){return this.manager.reset(n.items,t)},window.nxt=window.nxt||{},nxt.EventRenderer=function(){},nxt.EventRenderer.prototype.add=function(n,t){t.container.addEventListener(n.name,n.handler)},window.nxt=window.nxt||{},nxt.NodeRenderer=function(){},nxt.NodeRenderer.prototype.render=function(n,t){return t.content!==void 0?t.container.replaceChild(n.node,t.content):t.insertReference!==void 0?t.container.insertBefore(n.node,t.insertReference):t.container.appendChild(n.node),n.node},nxt.NodeRenderer.prototype.visible=function(n){return n!==void 0},nxt.NodeRenderer.prototype.unrender=function(n){n.container.removeChild(n.content)},window.nx=window.nx||{},nx.RestCollection=function(n){nx.AjaxModel.call(this,n),this.options=n,this.items=new nx.Collection},nx.RestCollection.prototype=Object.create(nx.AjaxModel.prototype),nx.RestCollection.prototype.constructor=nx.RestCollection,nx.RestCollection.prototype.create=function(n,t){this.request({url:this.options.url,method:"post",data:n.data.value,success:function(e){n.data.value=e,"function"==typeof t&&t.call(null,e)}})},nx.RestCollection.prototype.retrieve=function(n){var t=this;this.request({url:this.options.url,method:"get",success:function(e){t.items.items=e.map(function(n){var e=new t.options.item({data:n,url:t.options.url});return e}),"function"==typeof n&&n.call(null,t.items)}})},window.nx=window.nx||{},nx.RestDocument=function(n){nx.AjaxModel.call(this,n),this.options=n},nx.RestDocument.prototype=Object.create(nx.AjaxModel.prototype),nx.RestDocument.prototype.constructor=nx.RestDocument,nx.RestDocument.prototype.retrieve=function(n){var t=this;this.request({url:this.options.url,method:"get",success:function(e){t.data.value=e,"function"==typeof n&&n.call(null,e)}})},nx.RestDocument.prototype.save=function(n){var t=this;this.request({url:this.options.url,data:this.data.value,method:"put",success:function(e){t.data.value=e,"function"==typeof n&&n.call(null,e)}})},nx.RestDocument.prototype.remove=function(n){this.request({url:this.options.url,data:this.data.value,method:"delete",success:function(t){"function"==typeof n&&n.call(null,t)}})}})();